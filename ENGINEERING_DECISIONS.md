# ðŸ§  Engineering Decisions: Hot Zone Optimization

ì´ ë¬¸ì„œëŠ” **"Proximity Service"**ì˜ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ë„ìž…í•œ ë‘ ê°€ì§€ í•µì‹¬ ì „ëžµ(**500m ë°˜ê²½ ì œí•œ**, **ë°ì´í„° ë¶„ë¦¬ ì €ìž¥**)ì˜ ê¸°ìˆ ì  ë°°ê²½ê³¼ ì˜ì‚¬ê²°ì • ê³¼ì •ì„ ì •ë¦¬í•œ ê²ƒìž…ë‹ˆë‹¤.

---

## 1. ì™œ ê°•ë‚¨ì—­ì€ ê²€ìƒ‰ ë°˜ê²½ì„ 500më¡œ ì œí•œí–ˆëŠ”ê°€? (Dynamic Radius Capping)

### ðŸš¨ ë¬¸ì œì  (Problem)
- **ë°ì´í„° ë°€ì§‘ë„(Density)**: ê°•ë‚¨ì—­ ê°™ì€ í•«í”Œë ˆì´ìŠ¤ëŠ” `Geohash` ê²©ìž(Cell) í•˜ë‚˜ì— ìˆ˜ë§Œ ê°œì˜ ê°€ê²Œ ë°ì´í„°ê°€ ì¡´ìž¬í•©ë‹ˆë‹¤.
- **ì„±ëŠ¥ ì €í•˜(Performance Degradation)**: ì‚¬ìš©ìžê°€ **1km ë°˜ê²½** ê²€ìƒ‰ì„ ìš”ì²­í•˜ë©´, ì‹œìŠ¤í…œì€ ì•½ **17,000ê°œ**ì˜ í›„ë³´êµ°ì„ DBì—ì„œ í¼ì˜¬ë ¤ì•¼ í–ˆìŠµë‹ˆë‹¤.
    - **DB I/O ì¦ê°€**: ë””ìŠ¤í¬/ë©”ëª¨ë¦¬ì—ì„œ ëŒ€ëŸ‰ì˜ rowë¥¼ ì½ìŒ.
    - **Application ë¶€í•˜**: 17,000ê°œì˜ ì¢Œí‘œ ê±°ë¦¬ë¥¼ ì¼ì¼ì´ ê³„ì‚°(`Haversine formula`)í•˜ê³  ì •ë ¬í•´ì•¼ í•¨.
    - **Network ë¹„ìš©**: ë¶ˆí•„ìš”í•˜ê²Œ ë§Žì€ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê²Œ ë¨.
- **ê²°ê³¼**: ì‘ë‹µ ì†ë„(Latency)ê°€ ëŠë ¤ì§€ê³ , ìžì›ì„ ê³¼ë„í•˜ê²Œ ì ìœ í•˜ì—¬ ì „ì²´ ì‹œìŠ¤í…œ ì•ˆì •ì„±ì„ í•´ì¹¨.

### âœ… í•´ê²°ì±… (Solution)
- **ì „ëžµ**: íŠ¹ì • **í•«ì¡´(Hot Zone, ì˜ˆ: `wydm`)**ì—ì„œ ë“¤ì–´ì˜¨ ìš”ì²­ì€ ì‚¬ìš©ìžê°€ 1km ì´ìƒì„ ìš”ì²­í•˜ë”ë¼ë„ ê°•ì œë¡œ **ìµœëŒ€ 500m**ê¹Œì§€ë§Œ ê²€ìƒ‰í•˜ë„ë¡ ì œí•œ(`Capping`)í–ˆìŠµë‹ˆë‹¤.

### ðŸ“‰ íš¨ê³¼ (Impact)
1.  **ì¡°íšŒ ëŒ€ìƒ ê°ì†Œ**: 17,918ê±´(1km) â†’ **4,633ê±´(500m)**ìœ¼ë¡œ ì•½ **75% ê°ì†Œ**.
2.  **ì‘ë‹µ ì†ë„ í–¥ìƒ**: ì²˜ë¦¬í•´ì•¼ í•  ë°ì´í„°ê°€ 1/4ë¡œ ì¤„ì–´ë“¤ì–´ API ì‘ë‹µ ì‹œê°„ì´ íšê¸°ì ìœ¼ë¡œ ë‹¨ì¶•ë¨.
3.  **UX ê³ ë ¤**: ë°€ì§‘ ì§€ì—­ì—ì„œëŠ” 500m ì´ë‚´ì—ë„ ì¶©ë¶„ížˆ ë§Žì€ ì„ íƒì§€(4ì²œì—¬ ê°œ)ê°€ ìžˆìœ¼ë¯€ë¡œ, êµ³ì´ 1km ë°–ì˜ ê°€ê²Œë¥¼ ë³´ì—¬ì¤„ í•„ìš”ê°€ ë‚®ìŒ (Trade-off: ì •ë³´ëŸ‰ vs ì†ë„).
4.  **íˆ¬ëª…ì„±**: `adjustedRadius` í•„ë“œë¥¼ ì‘ë‹µì— í¬í•¨í•˜ì—¬, ì‚¬ìš©ìžê°€ ë°˜ê²½ì´ ì¡°ì •ë˜ì—ˆìŒì„ ì¸ì§€í•  ìˆ˜ ìžˆê²Œ í•¨.

---

## 2. ì™œ í•«ì¡´ ë°ì´í„°ë¥¼ ë³„ë„ í…Œì´ë¸”ë¡œ ë¶„ë¦¬í–ˆëŠ”ê°€? (Hot Zone Sharding)

### ðŸš¨ ë¬¸ì œì  (Problem)
- **íŠ¸ëž˜í”½ ë¶ˆê· í˜•(Traffic Skew)**: ì „ì²´ ê²€ìƒ‰ ìš”ì²­ì˜ ìƒë‹¹ìˆ˜(Pareto ë²•ì¹™, ìƒìœ„ 20%)ê°€ ê°•ë‚¨, ì„±ìˆ˜, í™ëŒ€ ë“± íŠ¹ì • ì§€ì—­ì— ì§‘ì¤‘ë¨.
- **ë‹¨ì¼ í…Œì´ë¸” ë³‘ëª©**: ëª¨ë“  ë°ì´í„°ë¥¼ `geohash_index` í•˜ë‚˜ì— ë„£ìœ¼ë©´, í•«ì¡´ ì¡°íšŒ ì¿¼ë¦¬ì™€ ì¼ë°˜ ì§€ì—­ ì¡°íšŒ ì¿¼ë¦¬ê°€ ê°™ì€ í…Œì´ë¸” ë½(Lock)ì´ë‚˜ ë²„í¼ í’€(Buffer Pool)ì„ ë‘ê³  ê²½ìŸí•˜ê²Œ ë¨.
- **í™•ìž¥ì˜ ì–´ë ¤ì›€**: í•«ì¡´ ë°ì´í„°ë§Œ ìºì‹œí•˜ê±°ë‚˜, í•«ì¡´ë§Œ ìŠ¤ì¼€ì¼ ì•„ì›ƒ(Scale-out)í•˜ê³  ì‹¶ì–´ë„ í…Œì´ë¸”ì´ ì„žì—¬ìžˆì–´ ë¶ˆê°€ëŠ¥í•¨.

### âœ… í•´ê²°ì±… (Solution)
- **ì „ëžµ**: í•«ì¡´(`wydm` prefix)ì˜ ë°ì´í„°ëŠ” **`geohash_index_hot`** í…Œì´ë¸”ì—, ë‚˜ë¨¸ì§€ëŠ” **`geohash_index`** í…Œì´ë¸”ì— ë‚˜ëˆ„ì–´ ì €ìž¥(**Table Partitioning/Sharding**)í–ˆìŠµë‹ˆë‹¤.

### ðŸ“ˆ ì´ì  (Benefits)
1.  **íŠ¸ëž˜í”½ ê²©ë¦¬ (Isolation)**:
    -   ê°•ë‚¨ì—­ ê²€ìƒ‰ì´ í­ì£¼í•´ë„, ì‹œê³¨ì´ë‚˜ ì¼ë°˜ ì£¼ê±°ì§€ ê²€ìƒ‰ì€ ë‹¤ë¥¸ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì„±ëŠ¥ ì €í•˜ê°€ ì „íŒŒë˜ì§€ ì•ŠìŒ.
    -   **ìž¥ì•  ê²©ë¦¬**: í•«ì¡´ DBì— ë¬¸ì œê°€ ìƒê²¨ë„ ì¼ë°˜ ì„œë¹„ìŠ¤ëŠ” ìƒì¡´ ê°€ëŠ¥.
2.  **í™•ìž¥ì„± í™•ë³´ (Scalability)**:
    -   ì¶”í›„ **"ê°•ë‚¨ì—­ ì „ìš© Redis"**ë‚˜ **"í•«ì¡´ ì „ìš© DB ì„œë²„"**ë¥¼ ë„ìž…í•˜ê¸° ë§¤ìš° ì‰¬ìš´ êµ¬ì¡°ê°€ ë¨. (ì½”ë“œì—ì„œ `repository.routing` ë¡œì§ë§Œ ìˆ˜ì •í•˜ë©´ ë¨).
    -   í•«ì¡´ í…Œì´ë¸”ë§Œ ë©”ëª¨ë¦¬ì— í†µì§¸ë¡œ ì˜¬ë ¤ë‘ëŠ” ì „ëžµ(Pinning) ì‚¬ìš© ê°€ëŠ¥.
3.  **ìœ ì§€ë³´ìˆ˜ ìœ ì—°ì„±**: í•«ì¡´ ë°ì´í„°ë§Œ ë°±ì—… ì£¼ê¸°ë¥¼ ì§§ê²Œ í•˜ê±°ë‚˜, ì¸ë±ìŠ¤ë¥¼ íŠœë‹í•˜ëŠ” ë“± ì°¨ë³„í™”ëœ ìš´ì˜ì´ ê°€ëŠ¥í•¨.

---

## 3. ì¢…í•©ì ì¸ ì•„í‚¤í…ì²˜ íë¦„

```mermaid
graph LR
    User[User Request] --> Service[SearchService]
    
    subgraph "Optimization Layer"
        Service --> CheckZone{Is Hot Zone? (wydm)}
        CheckZone -- Yes --> Limit[Radius = min(Radius, 500m)]
        CheckZone -- No --> Pass[Keep Radius]
    end
    
    Limit --> Router[Repository Routing]
    Pass --> Router
    
    subgraph "Storage Layer (Sharding)"
        Router -- Hot Zone --> DB_Hot[(Hot Data Table)]
        Router -- Normal Zone --> DB_Normal[(Normal Data Table)]
    end

    DB_Hot --> Result
    DB_Normal --> Result
```
